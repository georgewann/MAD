(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{251:function(e,a,t){"use strict";t.r(a);t(150),t(34),t(231);var l=t(0),n=t.n(l),i=t(12),r=t(232),s=t.n(r),c=t(5),u=t(35),m=(t(152),t(11),t(13),t(50)),o=t(14),d=t(104);function b(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}class E extends m.a{constructor(...e){var a;super(...e),a=this,b(this,"requestAlbumDetails",(async function(e){return a.fetcher.get(e).then(e=>e.data).then(e=>{const{album:t,songs:l}=e,{artist:n,description:i,alias:r,info:s}=t;return{picUrl:t.picUrl,publishTime:a.moment(new Date(t.publishTime),"YYYY-MM-DD").format("YYYY-MM-DD"),name:`${t.name}${r[0]?`(${r[0]})`:""}`,artist:{avatar:t.artist.picUrl,name:`${n.name}${n.alias[0]?`(${n.alias[0]})`:""}`},shareCount:s.shareCount,likedCount:s.likedCount,desc:null!=i?i:"",songs:l.map(e=>({title:e.name,id:e.id,desc:n.name,artistName:n.name,albumName:e.al.name,albumId:e.al.id,artistId:e.ar[0].id,type:"song",noImg:!0}))}})})),b(this,"getInitialData",(async function(e,t){const{id:l}=t.query,[n,i]=await Object(o.a)(a.requestAlbumDetails)("/api/album?id="+l);if(n)return Promise.reject(n);e.dispatch({type:d.a,data:i})}))}}var v=new E,p=t(237),h=t(236),g=t(26),C=t(242),j=t(32),y=t(239),O=t(10),f=t(244),k=t(61);const w=Object(l.memo)(({publishTime:e,name:a,artist:t,albumDesc:l,shareCount:i,likedCount:r})=>{const{isShowModal:s,isShowContent:c,onModalOpen:u,onModalClose:m}=Object(g.a)();return n.a.createElement(n.a.Fragment,null,s&&n.a.createElement(j.b,null,n.a.createElement(f.m,{isShow:c},n.a.createElement(f.k,null,n.a.createElement("div",{className:"count"},i),n.a.createElement("div",{className:"name"},"播放")),n.a.createElement(f.k,null,n.a.createElement("div",{className:"count"},r),n.a.createElement("div",{className:"name"},"点赞")),n.a.createElement(f.l,{isWhole:!0},l),n.a.createElement("div",{className:"close",onClick:m,"data-close":"true"},"×"))),n.a.createElement(f.i,null,n.a.createElement(k.b,{ready:!!e},e)),n.a.createElement(f.b,null,n.a.createElement(k.b,{ready:!!a},a)),n.a.createElement(f.d,null,n.a.createElement(C.a,{size:"small",url:null==t?void 0:t.avatar}),n.a.createElement(f.e,null,n.a.createElement(k.b,{ready:!!(null==t?void 0:t.name)},null==t?void 0:t.name))),n.a.createElement(f.l,{onClick:u},n.a.createElement(k.b,{ready:null!=l},l)))}),D=Object(l.memo)(()=>{var e,a,t;const r=Object(l.useRef)(),m=Object(l.useCallback)(e=>{const a=Object(o.b)(e,0,1);return 0===a?2:a.toFixed(2)},[]),d=Object(l.useCallback)(()=>r.current,[]),b=Object(g.b)(d,m),E=Object(c.h)().search,{id:C}=s.a.parse(E),j=Object(i.c)(e=>e.albumDetails.details),{data:k}=Object(u.b)("/api/album?id="+C,v.requestAlbumDetails,{initialData:j}),D=Object(i.b)(),I=Object(l.useCallback)(()=>{var e;(null==k||null===(e=k.songs)||void 0===e?void 0:e.length)&&D(O.a.setImmediatelyPlay(k.songs.map(e=>e.id)))},[k,D]);return n.a.createElement(f.a,null,n.a.createElement(f.g,{opacity:b},n.a.createElement(p.a,{title:2!==b?null==k||null===(e=k.artist)||void 0===e?void 0:e.name:""})),n.a.createElement(f.c,null,n.a.createElement(f.n,{url:null==k?void 0:k.picUrl})),n.a.createElement(f.j,{ref:r},n.a.createElement(w,{publishTime:null==k?void 0:k.publishTime,name:null==k?void 0:k.name,artist:null==k?void 0:k.artist,albumDesc:null==k?void 0:k.desc,shareCount:null==k?void 0:k.shareCount,likedCount:null==k?void 0:k.likedCount}),n.a.createElement(f.f,null,n.a.createElement(f.h,null,n.a.createElement(y.a,{songsCount:null==k||null===(a=k.songs)||void 0===a?void 0:a.length,onPlayIconClick:I})),n.a.createElement(h.b,{list:null!==(t=null==k?void 0:k.songs)&&void 0!==t?t:new Array(2).fill({type:"song"})}))))});D.getInitialProps=async(e,a)=>{await v.getInitialData(e,a)};a.default=D}}]);
//# sourceMappingURL=album-details-02798f0da3597fac4897.js.map