(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{249:function(e,t,a){"use strict";a.r(t);a(11),a(34),a(13);var n=a(0),r=a.n(n),l=a(234),i=a.n(l),o=a(2),c=a(35),d=a(5),u=a(60),s=a(12),p=a(236),m=a(51),b=a(14),g=a(237),h=(a(89),a(50));function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){v(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function v(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class k extends h.a{constructor(...e){var t;super(...e),t=this,v(this,"requestMVDetails",(async function(e){const[,a]=await Object(b.a)(t.fetcher.get)(e);var n;if(a)return y(y({},a.data.data),{},{desc:null!==(n=a.data.data.desc)&&void 0!==n?n:"",cover:a.data.data.cover?a.data.data.cover.replace(/https?/,"https"):""})})),v(this,"requestMVUrl",(async function(e){const[,a]=await Object(b.a)(t.fetcher.get)(e);if(a)return a.data.data.url?a.data.data.url.replace(/https?/,"https"):""})),v(this,"requestSameMVs",(async function(e){const[,a]=await Object(b.a)(t.fetcher.get)(e);if(a)return a.data.mvs.map(e=>({vtype:0,imgUrl:e.cover?e.cover.replace(/https?/,"https"):"",title:e.name,id:e.id,type:"bigMV"}))}))}}var O=new k,w=a(10),j=a(52),C=a(58),E=a(26),P=a(136),x=a(135),V=a(25),_=a(61);let M,I,N=e=>e;const S=o.d.div.withConfig({displayName:"MVPlay__StyledMVPlayPage",componentId:"uimvrk-0"})(["",""],V.a.aboveTablet(M||(M=N`
    padding: 0 10%;
 `))),T=o.d.div.withConfig({displayName:"MVPlay__SameMVsContainer",componentId:"uimvrk-1"})(["margin-top:30px;padding:0 12px;"]),F=o.d.div.withConfig({displayName:"MVPlay__SameMVsTitle",componentId:"uimvrk-2"})(["margin-bottom:20px;font-size:16px;color:",";"],({theme:e})=>e.fg),z=o.d.div.withConfig({displayName:"MVPlay__ArtistWrapper",componentId:"uimvrk-3"})(["margin-top:14px;display:flex;align-items:center;"]),B=Object(o.d)(m.a).withConfig({displayName:"MVPlay__StyledMyImg",componentId:"uimvrk-4"})(["&{width:40px;height:40px;border-radius:50%;}"]),D=o.d.div.withConfig({displayName:"MVPlay__VideoDetailsContainer",componentId:"uimvrk-5"})(["margin-top:25px;padding:0 12px;"]),$=o.d.div.withConfig({displayName:"MVPlay__VideoName",componentId:"uimvrk-6"})(["color:",";font-weight:bold;font-size:20px;line-height:1.3;> ","{height:1em;width:60%;}"],({theme:e})=>e.fg,_.a),q=o.d.div.withConfig({displayName:"MVPlay__PublishTime",componentId:"uimvrk-7"})(["margin-top:20px;font-size:14px;color:",";> ","{width:30%;}"],({theme:e})=>e.dg,_.a),R=o.d.div.withConfig({displayName:"MVPlay__VideoArtistName",componentId:"uimvrk-8"})(["font-size:14px;margin-left:10px;a{color:",";}> ","{min-width:80px;}"],({theme:e})=>e.fg,_.a),L=o.d.div.withConfig({displayName:"MVPlay__VideoDesc",componentId:"uimvrk-9"})(["margin-top:10px;font-size:14px;color:",";line-height:1.5;> ","{width:100% !important;background:grey;}"],({theme:e})=>e.dg,_.a),U=o.d.div.withConfig({displayName:"MVPlay__VideoMask",componentId:"uimvrk-10"})(["position:absolute;width:100%;height:100%;background:rgba(0,0,0,0.2);"]),W=o.d.img.withConfig({displayName:"MVPlay__IconImg",componentId:"uimvrk-11"})(["position:absolute;z-index:100;top:50%;left:50%;transform:translate3d(-50%,-50%,0);width:","px;height:","px;"],({large:e,small:t})=>e?47:t?20:32,({large:e,small:t})=>e?47:t?20:32),A=Object(o.d)(j.a).withConfig({displayName:"MVPlay__VideoLoadingIcon",componentId:"uimvrk-12"})(["&{position:absolute;z-index:100;top:50%;left:50%;transform:translate3d(-50%,-50%,0);width:32px;height:32px;}"]),J=o.d.div.withConfig({displayName:"MVPlay__PageBackWrapper",componentId:"uimvrk-13"})(["position:absolute;top:20px;left:15px;z-index:501;"]),X=Object(o.d)(W).withConfig({displayName:"MVPlay__FullScreenIcon",componentId:"uimvrk-14"})(["position:absolute;right:15px;z-index:501;top:20px;left:initial;transform:initial;"]),Y=Object(o.d)(g.a).withConfig({displayName:"MVPlay__StyledPageBack",componentId:"uimvrk-15"})(["&{background:none;}"]),G=o.d.div.attrs(({theme:e,progress:t,bufferedLength:a})=>({style:{backgroundImage:`linear-gradient(\n    90deg, ${e.secondary} 0, ${e.secondary} ${t}, transparent ${t}\n  ), linear-gradient(\n    90deg, ${e.dg} 0, ${e.dg} ${a}, ${e.fg} ${a}\n  )`}})).withConfig({displayName:"MVPlay__ProgressBar",componentId:"uimvrk-16"})(["position:absolute;bottom:0;left:0;width:100%;height:","px;color:",';transition:all 0.3s;touch-action:pan-x;&::after{content:"";position:absolute;height:30px;width:100%;top:-3px;}'],({isSeeking:e})=>e?10:4,e=>e.theme.fg),H=o.d.div.withConfig({displayName:"MVPlay__VideoWrapper",componentId:"uimvrk-17"})(["position:sticky;z-index:300;top:0;width:100%;font-size:0;background:",";",";"],({theme:e})=>e.mg,V.a.aboveTablet(I||(I=N`
    width: 500px;
    margin: 0 auto;
    position: relative;
  `))),K=o.d.div.withConfig({displayName:"MVPlay__DurationTime",componentId:"uimvrk-18"})(["display:inline-block;color:white;font-size:28px;"]),Q=o.d.div.withConfig({displayName:"MVPlay__DurationTimeWrapper",componentId:"uimvrk-19"})(["position:absolute;z-index:500;top:100%;transform:translateY(-160%);left:20px;background:rgba(0,0,0,0.3);padding:4px;",":first-of-type{font-weight:bold;}"],K),Z=Object(n.memo)(({playState:e,isVideoFocuced:t,onPlayClick:a,onPauseClick:n})=>"playing"===e?t?r.a.createElement(W,{src:x.a,onClick:n,large:!0}):null:"paused"===e?t?r.a.createElement(U,null,r.a.createElement(W,{src:P.a,onClick:a,large:!0})):null:"loading"===e?r.a.createElement(A,{color:C.b.secondary}):"canplay"===e?t?r.a.createElement(W,{src:P.a,onClick:a,large:!0}):null:void 0),ee=Object(n.memo)(()=>{var e;const[t,a]=Object(n.useState)("canplay"),[l,o]=Object(n.useState)(!0),[u,p]=Object(n.useState)(0),[m,g]=Object(n.useState)("0%"),{id:h}=Object(d.i)(),f=Object(s.b)(),y=Object(n.useRef)(),v=Object(n.useRef)(),k=Object(n.useRef)(),j=Object(n.useRef)(),C=Object(n.useRef)();Object(E.c)(()=>{document.getElementById("root").scrollTop=0},[h]),Object(E.c)(()=>(f(w.a.setShowPlayBar(!1)),()=>{f(w.a.setShowPlayBar(!0))}),[f]);const{data:P}=Object(c.b)(h&&"/api/mv/detail?mvid="+h,O.requestMVDetails,{refreshInterval:0,revalidateOnFocus:!1}),{data:x}=Object(c.b)(h&&"/api/mv/url?id="+h,O.requestMVUrl,{refreshInterval:0,revalidateOnFocus:!1}),V=Object(n.useCallback)(()=>{o(e=>!e),"canplay"===t&&(v.current.play(),C.current=!0),"playing"===t&&(y.current&&(clearTimeout(y.current),y.current=null),y.current=setTimeout(()=>{o(!1)},3e3))},[t]);Object(n.useEffect)(()=>{y.current&&"paused"===t&&(clearTimeout(y.current),y.current=null)},[t]);const _=Object(n.useCallback)(()=>v.current?Number.isNaN(v.current.duration)?0:u/v.current.duration:0,[u]),M=Object(n.useCallback)(()=>{v.current.play()},[]),I=Object(n.useCallback)(e=>{e.stopPropagation(),v.current.pause()},[]),N=Object(n.useCallback)(()=>{a("loading")},[]),T=Object(n.useCallback)(()=>{a("canplay")},[]),F=Object(n.useCallback)(e=>{console.error(e)},[]),z=Object(n.useCallback)(()=>{v.current.paused?a("canplay"):a("playing")},[]),B=Object(n.useCallback)(()=>{k.current||(p(v.current.currentTime),a("playing"))},[]),D=Object(n.useCallback)(()=>{a("playing")},[]),$=Object(n.useCallback)(()=>{a("paused")},[]),q=Object(n.useCallback)(()=>{v.current.play(),k.current=!1},[]),R=Object(n.useCallback)(()=>{k.current=!0},[]),L=Object(n.useCallback)(()=>{let e=0;try{e=v.current.buffered.end(v.current.buffered.length-1)}catch(e){console.warn(e)}const{duration:t}=v.current;t>0&&g(e/t*100+"%")},[]),U=Object(n.useCallback)(e=>{p(v.current.duration*e),v.current.currentTime=v.current.duration*e},[]),W=Object(n.useCallback)(e=>{const{width:t,left:a}=j.current.getBoundingClientRect();e-a>=t?U(.99):Number.isNaN(e)||U((e-a)/t)},[U]),A=Object(n.useCallback)(()=>{try{const e=v.current.buffered,t=[];for(let a=0;a<e.length;a++)t.push([e.start(a),e.end(a)]);return-1===t.findIndex(e=>v.current.currentTime>=e[0]&&v.current.currentTime<=e[1])}catch(e){return!1}},[]),ee=Object(n.useCallback)(()=>{},[]),ne=Object(n.useCallback)(()=>{o(!1);A()&&a("loading")},[A]),re=Object(n.useCallback)(e=>{const t=e.changedTouches[0].clientX;t>0&&W(t)},[W]),le=Object(n.useCallback)(e=>{e.stopPropagation();const{width:t,left:a}=e.currentTarget.getBoundingClientRect(),n=e.clientX;t>0&&n>0&&U((n-a)/t)},[U]);Object(n.useEffect)(()=>{i.a.isEnabled&&i.a.on("error",e=>{console.error("Failed to enable fullscreen",e)})},[]);const ie=Object(n.useCallback)(e=>{e.stopPropagation(),i.a.isEnabled?i.a.request(v.current):(v.current.webkitEnterFullscreen||v.current.enterFullScreen)&&(v.current.webkitEnterFullscreen&&v.current.webkitEnterFullscreen(),v.current.enterFullScreen&&v.current.enterFullScreen())},[]);return r.a.createElement(S,null,r.a.createElement(H,{style:{paddingBottom:(null==P?void 0:P.height)/(null==P?void 0:P.width)*100+"%"},onClick:V},l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(J,null,r.a.createElement(Y,{isBlack:!0})),r.a.createElement(X,{src:"/images/fullScreen-7511fd.png",small:!0,onClick:ie})),r.a.createElement(Z,{playState:t,isVideoFocuced:l,onPlayClick:M,onPauseClick:I}),r.a.createElement("video",{allowFullScreen:!0,style:{width:"100%",height:"100%"},onLoadedData:()=>{},onLoadedMetadata:T,src:x,controls:!1,poster:null==P?void 0:P.cover,"x5-video-player-type":"h5","x5-video-orientation":"landscape|portrait",playsInline:!0,"webkit-playsinline":"true",onLoadStart:N,onCanPlayThrough:z,onTimeUpdate:B,onPause:$,onPlay:D,ref:v,onSeeked:q,onSeeking:R,onError:F,onProgress:L}),C.current&&r.a.createElement(G,{progress:100*_()+"%",bufferedLength:m,isSeeking:k.current,ref:j,onClick:le,onTouchStart:ee,onTouchEnd:ne,onTouchMove:re}),k.current&&r.a.createElement(Q,null,r.a.createElement(K,null,Object(b.c)(u)),r.a.createElement(K,null,"_"+Object(b.c)(null==v||null===(e=v.current)||void 0===e?void 0:e.duration)))),r.a.createElement(te,{details:P}),r.a.createElement(ae,{mvId:h}))});ee.csr=!0;t.default=ee;const te=({details:e})=>{var t,a,l,i,o,c,d;const[s,p]=Object(n.useState)("");return Object(n.useEffect)(()=>{var t,a;if(null==e||null===(t=e.artists)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.id){(async()=>{const[,t]=await Object(b.a)(O.fetcher)("/api/artists?id="+e.artists[0].id);t&&p(t.data.artist.img1v1Url)})()}},[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement(D,null,r.a.createElement($,null,r.a.createElement(_.b,{ready:!!(null==e?void 0:e.name)},null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")),r.a.createElement(z,null,r.a.createElement(B,{url:s}),r.a.createElement(R,null,r.a.createElement(_.b,{ready:null!=(null==e?void 0:e.artistName)},r.a.createElement(u.b,{to:`/artist?id=${null==e||null===(a=e.artists)||void 0===a||null===(l=a[0])||void 0===l?void 0:l.id}&name=${null==e||null===(i=e.artists)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.name}`},null!==(c=null==e?void 0:e.artistName)&&void 0!==c?c:"")))),r.a.createElement(q,null,r.a.createElement(_.b,{ready:null!=(null==e?void 0:e.publishTime)},(null==e?void 0:e.publishTime)?"发布："+(null==e?void 0:e.publishTime):"")),r.a.createElement(L,null,r.a.createElement(_.b,{type:"textBlock",ready:null!=(null==e?void 0:e.desc),rows:3},null!==(d=null==e?void 0:e.desc)&&void 0!==d?d:""))))},ae=({mvId:e})=>{const{data:t}=Object(c.b)("/api/simi/mv?mvid="+e,O.requestSameMVs);return r.a.createElement(T,null,r.a.createElement(F,null,"相似MV"),r.a.createElement(p.b,{list:null!=t?t:new Array(4).fill({type:"bigMV"})}))}}}]);
//# sourceMappingURL=mv-play-69188eb1e2815ccdd10c.js.map